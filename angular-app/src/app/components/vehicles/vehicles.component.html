<div class="vehicles-container">
  <div class="header">
    <h1>V√©hicules</h1>
    <button class="btn btn-primary" (click)="refresh()">
      <span>üîÑ</span> Rafra√Æchir
    </button>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid" *ngIf="statistics">
    <div class="stat-card speed">
      <div class="stat-icon">‚ö°</div>
      <div class="stat-content">
        <div class="stat-label">Vitesse Moyenne</div>
        <div class="stat-value">{{ statistics.speed_stats?.avg?.toFixed(1) || 0 }} km/h</div>
        <div class="stat-range">
          Max: {{ statistics.speed_stats?.max?.toFixed(0) || 0 }} km/h
        </div>
      </div>
    </div>

    <div class="stat-card fuel">
      <div class="stat-icon">‚õΩ</div>
      <div class="stat-content">
        <div class="stat-label">Fuel Moyen</div>
        <div class="stat-value">{{ statistics.fuel_stats?.avg?.toFixed(1) || 0 }}%</div>
        <div class="stat-range">
          Min: {{ statistics.fuel_stats?.min?.toFixed(1) || 0 }}%
        </div>
      </div>
    </div>

    <div class="stat-card total">
      <div class="stat-icon">üöó</div>
      <div class="stat-content">
        <div class="stat-label">Total V√©hicules</div>
        <div class="stat-value">{{ total }}</div>
        <div class="stat-range">
          {{ statistics.by_status?.length || 0 }} statuts
        </div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-card">
    <div class="filters-grid">
      <div class="filter-group">
        <label>Statut</label>
        <select [(ngModel)]="selectedStatus" (change)="applyFilters()" class="form-control">
          <option value="">Tous les statuts</option>
          <option *ngFor="let status of statuses" [value]="status">{{ status }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label>Conducteur</label>
        <select [(ngModel)]="selectedDriver" (change)="applyFilters()" class="form-control">
          <option value="">Tous les conducteurs</option>
          <option *ngFor="let driver of drivers" [value]="driver">{{ driver }}</option>
        </select>
      </div>
    </div>

    <div class="filters-actions">
      <button class="btn btn-secondary" (click)="clearFilters()">
        ‚ùå R√©initialiser
      </button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Chargement des v√©hicules...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="alert alert-error">
    {{ error }}
  </div>

  <!-- Vehicles Grid -->
  <div *ngIf="!loading && !error && vehicles.length > 0" class="vehicles-grid">
    <div class="vehicle-card" *ngFor="let vehicle of vehicles">
      <div class="vehicle-header">
        <div class="vehicle-id">
          <span class="icon">üöó</span>
          <strong>{{ vehicle.vehicule_id }}</strong>
        </div>
        <span class="badge" [ngClass]="getStatusClass(vehicle.status || 'inactive')">
          {{ vehicle.status }}
        </span>
      </div>

      <div class="vehicle-driver">
        <span class="icon">üë§</span>
        <strong>{{ vehicle.driver }}</strong>
      </div>

      <div class="vehicle-metrics">
        <div class="metric" [ngClass]="getSpeedClass(vehicle.vitesse || 0)">
          <span class="metric-icon">‚ö°</span>
          <div class="metric-info">
            <div class="metric-label">Vitesse</div>
            <div class="metric-value">{{ vehicle.vitesse }} km/h</div>
          </div>
          <div class="metric-bar">
            <div class="metric-bar-fill" [style.width.%]="((vehicle.vitesse || 0) / 150) * 100"></div>
          </div>
        </div>

        <div class="metric" [ngClass]="getFuelClass(vehicle.fuel_level || 0)">
          <span class="metric-icon">‚õΩ</span>
          <div class="metric-info">
            <div class="metric-label">Carburant</div>
            <div class="metric-value">{{ vehicle.fuel_level }}%</div>
          </div>
          <div class="metric-bar">
            <div class="metric-bar-fill" [style.width.%]="vehicle.fuel_level || 0"></div>
          </div>
        </div>
      </div>

      <div class="vehicle-location">
        <span class="icon">üìç</span>
        <div class="location-info">
          <div class="location-label">Position GPS</div>
          <div class="location-coords">
            {{ vehicle.latitude?.toFixed(4) }}, {{ vehicle.longitude?.toFixed(4) }}
          </div>
        </div>
      </div>

      <div class="vehicle-footer">
        <span class="timestamp">
          {{ vehicle.timestamp | date:'dd/MM/yyyy HH:mm' }}
        </span>
        <span class="source">
          {{ vehicle.source_file }}
        </span>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="!loading && getTotalPages() > 1">
    <button 
      class="btn btn-secondary" 
      (click)="changePage(page - 1)" 
      [disabled]="page === 1"
    >
      ‚Üê Pr√©c√©dent
    </button>
    
    <div class="page-numbers">
      <button 
        *ngFor="let pageNum of getPageNumbers()" 
        class="btn" 
        [class.btn-primary]="pageNum === page"
        [class.btn-secondary]="pageNum !== page"
        (click)="changePage(pageNum)"
      >
        {{ pageNum }}
      </button>
    </div>
    
    <button 
      class="btn btn-secondary" 
      (click)="changePage(page + 1)" 
      [disabled]="page === getTotalPages()"
    >
      Suivant ‚Üí
    </button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && vehicles.length === 0" class="empty-state">
    <div class="empty-icon">üöó</div>
    <h3>Aucun v√©hicule trouv√©</h3>
    <p>Essayez de modifier vos filtres</p>
  </div>
</div>
